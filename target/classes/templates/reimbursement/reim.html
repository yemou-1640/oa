<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>新建报销申请-OA办公系统</title>
    <link th:href="@{/layuiadmin/layui/css/layui.css}" rel="stylesheet">
    <link th:href="@{/layuiadmin/style/admin.css}" rel="stylesheet">
    <link th:href="@{/css/reimbursement.css}" rel="stylesheet">
</head>
<body>
<div class="layui-fluid">
    <div class="layui-card">
        <!-- 导航链接 -->
        <div class="layui-card-header">
            <a href="/reimbursement/toList" class="layui-btn layui-btn-primary layui-btn-sm">
                <i class="layui-icon layui-icon-list"></i> 查看报销记录
            </a>
        </div>

        <!-- 报销申请表单 -->
        <div class="layui-card-body">
            <form class="layui-form" lay-filter="reimForm" style="padding: 20px;">
                <div class="layui-form-item">
                    <label class="layui-form-label">报销类型</label>
                    <div class="layui-input-block">
                        <select name="type" lay-verify="required">
                            <option value="">请选择类型</option>
                            <option value="差旅费">差旅费</option>
                            <option value="交通费">交通费</option>
                            <option value="餐饮费">餐饮费</option>
                            <option value="办公用品">办公用品</option>
                        </select>
                    </div>
                </div>

                <div class="layui-form-item">
                    <label class="layui-form-label">金额</label>
                    <div class="layui-input-block">
                        <input type="number" name="amount" lay-verify="required|number" 
                               placeholder="请输入报销金额（元）" class="layui-input">
                    </div>
                </div>

                <div class="layui-form-item">
                    <label class="layui-form-label">报销说明</label>
                    <div class="layui-input-block">
                        <textarea name="description" placeholder="请输入报销详细说明" 
                                  class="layui-textarea" lay-verify="required"></textarea>
                    </div>
                </div>

                <div class="layui-form-item">
                    <div class="layui-input-block">
                        <button class="layui-btn" lay-submit lay-filter="submitBtn">立即提交</button>
                        <button type="reset" class="layui-btn layui-btn-primary">重置</button>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>

<script th:src="@{/layuiadmin/layui/layui.js}"></script>
<script th:inline="none">
    layui.use(['form', 'layer'], function(){
        var form = layui.form,
            layer = layui.layer,
            $ = layui.$;

        // 表单提交
        form.on('submit(submitBtn)', function(data){
            var btn = $(this).find('button[lay-filter="submitBtn"]');
            btn.prop('disabled', true); // 禁用按钮
            var field = data.field;
            
            $.ajax({
                url: '/reimbursement/add',
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify(field),
                success: function(data) {
                    if(data.code === 0) {
                        layer.msg('提交成功', {icon: 1});
                        setTimeout(function(){
                            window.location.href = '/reimbursement/toList';
                        }, 1500);
                    } else {
                        layer.msg("提交失败", {icon: 2});
                    }
                },
                complete: function() {
                    btn.prop('disabled', false); // 请求完成后恢复按钮
                }
            });
            return false;
        });
    });
</script>
</body>
</html>